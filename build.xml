<?xml version="1.0" encoding="utf-8" ?>
<project name="Charba" default="javadoc" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">
    
    <!--
        Apache IVY ANT lib include
    -->
	<taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" />
   
	<!-- 
		CHARBA project configuration 
	-->
	<property name="charba.version" value="1.0" />
	<property name="charba.built.by" value="www.pepstock.org" />
	<tstamp>
			<format property="TODAY" pattern="yyyy-MM-dd HH:mm:ss" />
	</tstamp>
	<property name="src.dir" value="src" />
	<property name="dest.dir" value="classes" />
	<property name="dist.dir" value="dist" />
    <property name="module.archive.file" value="${dist.dir}/charba.jar" />
	<property name="temp.dir" value="temp" />
	<property name="javadoc.dir" value="javadoc" />
    <property name="javadoc.archive.file" value="${dist.dir}/charba-javadoc.jar" />

	<!-- 
		JAVA compiler options 
	-->
    <property name="javac.debug" value="true" />
    <property name="javac.debuglevel" value="lines,vars,source" />
    <property name="javac.source" value="1.7" />
    <property name="javac.target" value="1.7" />
    <property name="javac.includeantruntime" value="false" />
    <property name="javac.nowarn" value="true" />

    <target name="clean" description="Cleans folders">
    	<mkdir dir="${dest.dir}"/>
    	<mkdir dir="${dist.dir}"/>
    	<mkdir dir="${javadoc.dir}"/>
    	<delete failonerror="false" includeemptydirs="true">
            <fileset dir="${dist.dir}" includes="**/*"/>
            <fileset dir="${dest.dir}" includes="**/*"/>
    		<fileset dir="${javadoc.dir}" includes="**/*"/>
        </delete>
    </target>

    <!--
        Apache IVY retrive
    -->
	<target name="ivyRetrieve">
        <ivy:retrieve sync="true" pattern="lib-ivy/[artifact]-[revision](-[classifier]).[ext]" pathid="ivyPath" />
    </target>

	
   <target name="compile" description="Compile Charba" depends="clean, ivyRetrieve">
        <javac srcdir="${src.dir}" includes="**" encoding="utf-8" destdir="${dest.dir}" includeantruntime="${javac.includeantruntime}"
            source="${javac.source}" target="${javac.target}" nowarn="${javac.nowarn}" debug="${javac.debug}" debuglevel="${javac.debuglevel}">
            <classpath refid="ivyPath"/>
        </javac>
        <copy todir="${dest.dir}">
            <fileset dir="${src.dir}"/>
        </copy>
    </target>

   <target name="build" description="Build Charba distribution" depends="compile">
	<!-- Creates the JAR file adding the classes folder and adding the mnifest part -->
		<jar jarfile="${module.archive.file}">
			<fileset dir="${dest.dir}"/>
			<manifest>
				<section name="Charba">
					<attribute name="Version" value="${charba.version}" />
					<attribute name="Built-By" value="${charba.built.by}" />
					<attribute name="Creation-time" value="${TODAY}" />
				</section>
			</manifest>
		</jar>
   	</target>
	
	<target name="javadoc" depends="build">
		<javadoc destdir="${javadoc.dir}"
				useexternalfile="yes"
		         author="true"
		         version="true"
		         use="true"
		         windowtitle="Charba, GWT wrapper for CHART.JS">
			<classpath>
				<path refid="ivyPath"/>
				<fileset dir="${dest.dir}"/>
				<pathelement path="${java.class.path}" />
			</classpath>
			<packageset dir="${src.dir}" defaultexcludes="yes">
				<include name="org/pepstock/**"/>
			</packageset>
		</javadoc>
		<jar jarfile="${javadoc.archive.file}">
			<fileset dir="${javadoc.dir}"/>
			<manifest>
				<section name="Charba">
					<attribute name="Version" value="${charba.version}" />
					<attribute name="Built-By" value="${charba.built.by}" />
					<attribute name="Creation-time" value="${TODAY}" />
				</section>
			</manifest>
		</jar>
	</target>
</project>